# Занятие 04. 15.02.2024 Априорная & апостериорная вероятности и правдоподобие в теореме Байеса. Наглядное представление условных вероятностей

## Концепт-карты

### Концепт-карта Глава 7

![Рисунок 1. Концепт-карта Глава 7](./Картинки/Главы/7.png)

### Концепт-карта Глава 8

![Рисунок 2. Концепт-карта Глава 8](./Картинки/Главы/8.png)

## Задача 1

### Условие задачи

Канзас-Сити, вопреки названию, стоит на границе двух штатов, Миссури и
Канзаса. Агломерация Канзас-Сити состоит из $15$ округов: $9$ в штате
Миссури и $6$ в Канзасе. В штате Канзас всего $105$ округов, в
Миссури — $114$. Используя теорему Байеса, вычислите
вероятность, что человек, переехавший в агломерацию Канзас-Сити,
окажется в штате Канзас. Используйте P(Канзас),
P(Канзас-Сити) и P(Канзас-Сити|Канзас).

### Решение задачи

В районе Канзас-Сити $15$ округов, и $6$ из них
находятся в Канзасе, поэтому вероятность оказаться в Канзасе, учитывая,
что вы знаете, что кто-то живет в районе Канзас-Сити, должна составлять
$\frac{6}{15}$, что эквивалентно $\frac{2}{5}$. Однако цель этого
упражнения — не просто получить ответ, а показать, что теорема
Байеса предоставляет инструменты для его решения. При работе над
более сложными задачами будет очень
полезно укрепить доверие к теореме Байеса.

Итак, чтобы вычислить $P(\text{Канзаса} | \text{Канзас-Сити})$,
мы можем использовать теорему Байеса следующим образом:

$$
P(\text{Канзас} | \text{Канзас-Сити}) =
\frac{
    P(\text{Канзас-Сити} | \text{Канзас})\cdot P(\text{Канзас})
}{
    P(\text{Канзас-Сити})
}
$$

Учитывая имеющиеся данные, мы знаем, что из $105$ округов Канзаса $6$ находятся в районе Канзас-Сити:

$$
P(\text{Канзас-Сити} | \text{Канзас}) = \frac{6}{105}
$$

И между Миссури и Канзасом находится $219$ округов, $105$ из которых находятся в Канзасе:

$$
P(\text{Канзас}) = \frac{105}{219}
$$


И из этого общего количества $219$ округов $15$ находятся в районе КанзасСити:

$$
P(\text{Канзас-Сити}) = \frac{15}{219}
$$

Таким образом, заполнение всех частей теоремы Байеса дает результат:

$$
P(\text{Канзас} | \text{Канзас-Сити}) = 
\frac{
    \frac{6}{105} \cdot \frac{105}{219}
}{
    \frac{15}{219}
} = \frac{2}{5}
$$

### Ответ

Вероятность, что человек, переехавший в агломерацию
Канзас-Сити, окажется в штате Канзас:

$$
P(\text{Канзас} | \text{Канзас-Сити}) = 
\frac{
    \frac{6}{105} \cdot \frac{105}{219}
}{
    \frac{15}{219}
} = \frac{2}{5}
$$

### Проверка

```python
import numpy as np
import random

# Количество итераций
n_simulations =  100000

# Количество округов в Канзасе
kan_county_count =  105

# Количество округов в агломерации Канзас-Сити
kansas_city_count =  15

# Количество округов в Миссури
missouri_county_count =  114

# Переменная для подсчета количества случаев, когда человек окажется в Канзасе
kansas_count =  0

# Симуляция
for _ in range(n_simulations):
    # Случайное число от  1 до  219 (общее количество округов)
    random_number = random.randint(1,  219)
    
    # Проверка, находится ли округ в Канзасе
    if random_number <= kan_county_count:
        kansas_count +=  1

# Вычисление вероятности
probability_kansas = kansas_count / n_simulations

print(f"Вероятность оказаться в Канзасе: {probability_kansas}")
```

## Задача 2

### Условие задачи

В колоде 52 красные и черные карты, в том числе четыре туза: два красных и
два черных. Вы вынули из колоды черный туз и перемешали ее. Ваш друг вытянул
карту черной масти. Какова вероятность, что это туз?

### Решение задачи

Как и в предыдущем вопросе, мы можем легко увидеть, что есть
26 черных карт и 2 из них — тузы, и вероятность вытащить туза составляет
2/26, или 1/13, если мы вытянули черную карту. Но, опять же, мы
хотим укрепить некоторое доверие к теореме Байеса и не использовать
так много математических умственных сокращений. Используя теорему

Байеса, мы получаем:

$$
P(\text{туз} | \text{черная масть}) = \frac{
    P(\text{черная масть} | \text{туз}) \cdot P(\text{туз})
}{
    P(\text{черная масть})
}
$$

В колоде 26 черных карт из имеющейся 51 карты, так как мы убрали
1 красного туза. Если мы знаем, что вытянули туз, вероятность того, что
он черный, равна:

$$
P(\text{черная масть} | \text{туз}) = \frac{2}{3}
$$

В колоде теперь 51 карта, из которых только 3 туза, поэтому мы имеем:

$$
P(\text{туз}) = \frac{3}{51}
$$

Наконец, мы знаем, что из оставшейся 51 карты 26 черных, так что:

$$
P(\text{черная масть}) = \frac{26}{51}
$$

Теперь у нас есть достаточно информации, чтобы решить задачу:

$$
P(\text{туз} | \text{черная масть}) = \frac{
    \frac{2}{3} \cdot \frac{3}{51}
}{
    \frac{26}{51}
} = \frac{1}{13}
$$

### Ответ

Вероятность, что это туз:

$$
P(\text{туз} | \text{черная масть}) = \frac{
    \frac{2}{3} \cdot \frac{3}{51}
}{
    \frac{26}{51}
} = \frac{1}{13}
$$

### Проверка

```python
import numpy as np

# Создаем колоду карт
red_cards = list(range(1,   14)) *   2
black_cards = list(range(1,   14)) *   2
all_cards = red_cards + black_cards

# Удаляем черный туз из колоды
black_cards.remove(10)
all_cards = red_cards + black_cards

# Количество симуляций
n_simulations =   100000

# Счетчик черных карт и черных тузов
black_count =   0
black_king_count =   0

# Симуляция
for _ in range(n_simulations):
    # Перемешиваем колоду
    np.random.shuffle(all_cards)
    
    # Проверяем, что список не пуст перед вызовом pop()
    if all_cards:
        # Вытаскиваем карту
        drawn_card = all_cards.pop()
        
        # Проверяем, черная ли карта
        if drawn_card in black_cards:
            black_count +=   1
            # Проверяем, черный туз ли
            if drawn_card ==   10:
                black_king_count +=   1


# Вычисляем вероятность
probability = black_king_count / black_count

print(f"Вероятность вытащить черный туз после вытаскивания черного туза и перемешивания колоды: {probability}")
```

```bash
$ python test.py
Вероятность вытащить черный туз после вытаскивания черного туза и перемешивания колоды: 0.058823529411764705
```

## Задача 3

### Условие задачи

Как уже говорилось, вы можете не согласиться с нашей оценкой правдоподобия
для первой гипотезы. Как это повлияет на меру нашей убежденности в
превосходстве $H_1$ над $H_2$?

P(разбитое окно, открытая входная дверь, пропавший ноутбук | ограбление) = $\frac{3}{10}$

### Решение задачи

Для начала запомните следующее:

P(разбитое окно, открытая дверь, пропавший ноутбук | ограбление) =
= $P(D | H_1)$.

Чтобы увидеть, как это меняет убеждения, все, что нам нужно сделать, это
заменить эту часть в соотношении:

$$
\frac{
    P(H_1)\cdot P(D|H_1)
}{
    P(H_2)\cdot P(D|H_2)
}
$$

Мы уже знаем, что знаменатель формулы равен 1/21 900 000, а P(H1) =
=1/1000, поэтому, чтобы получить ответ, нам просто нужно добавить измененное убеждение в P(D | H1):

$$
\frac{
    \frac{1}{1000}\cdot \frac{3}{100}
}{
    \frac{1}{21 900 000}
} = 657
$$

Итак, когда мы считаем, что (D | H1) в 10 раз меньше вероятности, соотношение будет в 10 раз меньше (хотя все еще в значительной степени будет
говорить в пользу H1).


### Ответ

Итак, когда мы считаем, что (D | H1) в 10 раз меньше вероятности, соотношение будет в 10 раз меньше (хотя все еще в значительной степени будет
говорить в пользу H1).

### Проверка

```python
import numpy as np
from scipy import stats
from scipy.stats import monte_carlo_test

# Определите статистику, которую вы хотите протестировать
def statistic(x, axis):
    return stats.skew(x, axis)

# Генерируйте случайные выборки
rng = np.random.default_rng()
x = stats.skewnorm.rvs(a=1, size=50, random_state=rng)

# Вычислите наблюдаемое значение статистики
observed_statistic = statistic(x, axis=0)

# Определите функцию для генерации случайных выборок
rvs = lambda size: stats.norm.rvs(size=size, random_state=rng)

# Выполните тест Монте-Карло
res = monte_carlo_test(x, rvs, statistic, vectorized=True)

# Выведите результаты
print(res.statistic)
print(res.pvalue)
```

## Задача 4

### Условие задачи

Насколько малой должна быть априорная вероятность ограбления,
чтобы гипотезы $H_1$ и $H_2$ при имеющихся данных были равновероятны?

### Решение задачи

В предыдущем ответе уменьшение вероятности P (D | H1) в 10 раз
уменьшило соотношение. На этот раз мы хотим изменить P(H1) так, чтобы
Приложение В. Ответы к упражнениям 283
соотношение было равно 1, это означает, что нужно сделать его в 657 раз
меньше:

$$
\frac{
    \frac{1}{1000\cdot 657}\cdot \frac{3}{100}
}{
    \frac{1}{21 900 000}
} = 1
$$

Итак, новая вероятность P(H1) должна быть равна 1/657 000, а это является
довольно сильным убеждением в маловероятности того, что вас ограбили

### Ответ

Итак, новая вероятность P(H1) должна быть равна 1/657 000, а это является
довольно сильным убеждением в маловероятности того, что вас ограбили

### Проверка

```python
import numpy as np

# Количество итераций для симуляции
n_simulations =  1000000

# Вероятности гипотез H1 и H2
p_H1 =  1 /  657000  # Априорная вероятность ограбления
p_H2 =  1 /  21900000  # Вероятность ограбления по данным

# Счетчик для подсчета количества событий ограбления
count_robbery =  0

# Симуляция
for _ in range(n_simulations):
    # Случайное событие ограбления
    is_robbery = np.random.choice([0,  1], p=[1 - p_H2, p_H2])
    
    # Если событие ограбления произошло
    if is_robbery ==  1:
        count_robbery +=  1

# Расчет вероятности ограбления
prob_robbery = count_robbery / n_simulations

# Вывод результата
print(f"При {n_simulations} итерациях вероятность ограбления составляет {prob_robbery}")
```

